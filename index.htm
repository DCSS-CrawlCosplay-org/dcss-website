<!DOCTYPE html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="underscore.js"></script> <!-- used only a little -->
        <!-- Latest compiled and minified CSS -->
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"> -->
        <link rel="stylesheet" href="bootstrap-3.3.2-dist/css/bootstrap.min.darkly.css">

        <!-- Optional theme -->
        <!--
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
        -->

        <style>
        .panel-transparent {
            background: none;
        }

        .panel-transparent .panel-heading{
            background: rgba(122, 130, 136, 0.5)!important;
        }

        .panel-transparent .panel-body{
            background: rgba(46, 51, 56, 0.5)!important;
        }
        </style>

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <script>
            // http://www.davidjuth.com/rest-demo-jquery-rss.aspx
            $( function()
            {
                $("#feedContainer").empty();

                $.get("feed.rss", function(data) {                           
                    
                    $('#newsContainer').append("<ul>");
                    $(data).find('item').slice(0, 4).each(function() {  
                        var $item = $(this);  
                        var title = $item.find('title').text();  
                        var link = $item.find('link').text();  
            
                        var html = "<a href=\"" + link + "\"><li>" + title + "</a></li>";  
            
                        $('#newsContainer').append(html);  
                    });
                    $('#newsContainer').append("</ul>");
                });
            });
        </script>

        <script>
            numCaptions = 3
            captions = [];
            function getPlayerCaptions() {
                $.get("dgl-status.json", function(data) {
                    // we only want candidates with full info (some entries lack xl/race/background/location, so test for xl)
                    // also check they have a species -- player might be on start screen, which is boring
                    // and that there's a watch url
                    candidates = data.filter(function(element) { return "XL" in element && element["species"] != '' && "watchurl" in element});
                    // if there are enough candidates with spectators, pick from those (other viewers is probably a good sign)
                    popular_candidates = candidates.filter(function(element) { return element['viewers'] > 0});
                    if (popular_candidates.length >= numCaptions) {
                        console.log("using popular candiates");
                        candiates = popular_candidates;
                    }
                    selected = _.sample(candidates, numCaptions);
                    for (var i = 0; i < numCaptions; i++) {
                        c = selected[i];
                        $( "#now-playing-" + i + "-heading" ).html("Now playing: " + c["name"]);
                        loc = c["location"];
                        loc = loc.charAt(0).toUpperCase() + loc.slice(1); // haaaacky
                        $( "#now-playing-" + i + "-text" ).html("Level " + c["XL"] + " " + c["species"] + " " + c["background"] + "<br>" + loc);
                        $( "#now-playing-" + i + "-link" ).html("Watch live now.");
                        $( "#now-playing-" + i + "-link" ).attr("href", c["watchurl"]);
                    }
                });
            }
            $( getPlayerCaptions() );
        </script>

        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body style="background: black;">
        <div class="container">
            <h1 class="text-center" title="* Well, somewhat original."><a href="index.htm">Dungeon Crawl Stone Soup<br><small>An Original* Roguelike</small></a></h1>

            <!-- mention free/open-source? -->
            <p class="lead text-center">A single-player adventure through dungeons filled with dangerous and unfriendly monsters in a quest to find the mystifyingly fabulous Orb of Zot. <a href="about.htm">Read more...</a></p>
            <center> <!-- XXX: HACKY!!!!!(?) -->
                <a href="play.htm" class="btn btn-lg btn-success" role="button">Play Online Now!</a>
                <br><br>
                <p class="text-center">Or download for: <a href="download.htm#windows">Windows</a>, <a href="download.htm#osx">OS X</a>, <a href="download.htm#android">Android</a> and <a href="download.htm#linux">Linux</a>.</p>
                <br>
            </center>

            <center>
            <div id="carousel-splash" class="carousel slide" data-ride="carousel">

                <!-- Wrapper for slides -->
                <div class="carousel-inner" role="listbox">
                    <div class="item active">
                        <img src="splashimgs/dcss-splash-01.png">
                        <div class="carousel-caption">
                            <div class="panel panel-default panel-transparent" style="width:50%;">
                                <div id="now-playing-0-heading" class="panel-heading">Loading game...</div>
                                <div class="panel-body">
                                    <p id="now-playing-0-text"></p>
                                    <a id="now-playing-0-link" href="#"></a><br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <img src="splashimgs/dcss-splash-02.png">
                        <div class="carousel-caption">
                            <div class="panel panel-default panel-transparent" style="width:50%;">
                                <div id="now-playing-1-heading" class="panel-heading">Loading game...</div>
                                <div class="panel-body">
                                    <p id="now-playing-1-text"></p>
                                    <a id="now-playing-1-link" href="#"></a><br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="item">
                        <img src="splashimgs/dcss-splash-03.png">
                        <div class="carousel-caption">
                            <div class="panel panel-default panel-transparent" style="width:50%;">
                                <div id="now-playing-2-heading" class="panel-heading">Loading game...</div>
                                <div class="panel-body">
                                    <p id="now-playing-2-text"></p>
                                    <a id="now-playing-2-link" href="#"></a><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls -->
                <a class="left carousel-control" href="#carousel-splash" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#carousel-splash" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </center>

            <h2>Latest News</h2>
            <div class="container" id="newsContainer"></div>
            <p><a href="http://crawl.develz.org/wordpress/blog">All news...</a></p>

            <h2>Help & Community</h2>
            <ul>
                <li><a href="about.htm">About</a>: Learn more about DCSS.</li>
                <li><a href="http://crawl.chaosforge.org/">Wiki</a>: Up-to-date information on game items &amp; concepts.</li>
                <li><a href="https://crawl.develz.org/tavern/">Forum</a>: "Debate" strategy and changes on our forums.</a></li>
                <li><a href="http://webchat.freenode.net/?channels=%23%23crawl">IRC</a>: ##crawl on Freenode IRC is filled with helpful (and otherwise) souls who can offer real-time advice.</li>
                <li><a href="https://crawl.develz.org/mantis/">Bug Reports</a>: Found a problem? Let us know!</li>
            </ul>

            <hr>
            <p class="small text-right">You are too berserk!</p>

        </div>
    </body>
</html>
