<!DOCTYPE html>
    <head>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="underscore.js"></script> <!-- used only a little -->
        <!-- Latest compiled and minified CSS -->
        <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css"> -->
        <link rel="stylesheet" href="bootstrap-3.3.2-dist/css/bootstrap.min.darkly.css">

        <!-- Optional theme -->
        <!--
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
        -->

        <style>
        .panel-transparent {
            background: none;
        }

        .panel-transparent .panel-heading{
            background: rgba(122, 130, 136, 0.5)!important;
        }

        .panel-transparent .panel-body{
            background: rgba(46, 51, 56, 0.5)!important;
        }
        </style>

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <script>
            // http://www.davidjuth.com/rest-demo-jquery-rss.aspx
            $( function()
            {
                $("#feedContainer").empty();

                $.get("feed.rss", function(data) {                           
                    
                    $('#newsContainer').append("<ul>");
                    $(data).find('item').slice(0, 4).each(function() {  
                        var $item = $(this);  
                        var title = $item.find('title').text();  
                        var link = $item.find('link').text();  
            
                        var html = "<a href=\"" + link + "\"><li>" + title + "</a></li>";  
            
                        $('#newsContainer').append(html);  
                    });
                    $('#newsContainer').append("</ul>");
                });
            });
        </script>

        <script>
            function setPlayerCaptions(data) {
                    n = $( "#tiles div" ).length;
                    // Preconditions:
                    // We only want candidates with full info (some entries lack xl/race/background/location, so test for xl)
                    // Check they have a species -- player might be on start screen
                    // And we need a watch url
                    candidates = data.filter(function(element) { return "XL" in element && element["species"] != '' && "watchurl" in element});
                    // There are a two competing goals with the candidate selection:
                    // * random each refresh
                    // * picks the best candidates
                    // To balance this, partition the candidate list into good, ok & bad groups, and select from each in turn as required
                    // Good: has spectators
                    // OK: idle < 5 secs
                    // Bad: everything else
                    good_candidates = []
                    ok_candidates = []
                    bad_candidates = []
                    _.each(candidates, function(c) {
                        if (c['viewers'] > 0) {
                            good_candidates.push(c);
                        } else if (c['idle'] < 5) {
                            ok_candidates.push(c);
                        } else {
                            bad_candidates.push(c);
                        }
                        });
                    selected_candidates = _.sample(good_candidates, n);
                    if (selected_candidates.length < n) {
                        n = n - selected_candidates.length;
                        selected_candidates = selected_candidates.concat(_.sample(ok_candidates, n));
                        if (selected_candidates.length < n) {
                            n = n - selected_candidates.length;
                            selected_candidates = selected_candidates.concat(_.sample(bad_candidates, n));
                         }
                    }
                    // Note that we might not have enough candidates at this point
                    if (selected_candidates.length !=  $( "#tiles div" ).length) {
                        console.log("Warning: only found " + selected_candidates.length + " candidates.");
                    }

                    captions = []
                    _.each(selected_candidates, function(c) {
                        captions.push([c["name"], "Level " + c["XL"] + " " + c["species"] + " " + c["background"] + "<br>" + c["location"],  c["watchurl"]]);
                        });

                    $( "#tiles div" ).each( function(i) {
                        caption = captions.pop();
                        $( this ).children( ".dcss-tile-heading" ).html(caption[0]);
                        $( this ).children( ".dcss-tile-body" ).html(caption[1]);
                        $( this ).children( ".dcss-tile-link" ).attr('href', caption[2]);
                    });

                    $( "#dcss-online-link" ).text("See all " + candidates.length + " online games...");
            }
            $( $.get("dgl-status.json", setPlayerCaptions ));
        </script>

        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body style="background: black;">
        <div class="container">
            <h1 class="text-center" title="* Well, somewhat original."><a href="index.htm">Dungeon Crawl Stone Soup<br><small>An Original* Roguelike</small></a></h1>

            <!-- mention free/open-source? -->
            <p class="lead text-center">A single-player adventure through dungeons filled with dangerous and unfriendly monsters in a quest to find the mystifyingly fabulous Orb of Zot. <a href="about.htm">Read more...</a></p>
            <center> <!-- XXX: HACKY!!!!!(?) -->
                <a href="play.htm" class="btn btn-lg btn-success" role="button">Play Online Now!</a>
                <br><br>
                <p class="text-center">Or download for: <a href="download.htm#windows">Windows</a>, <a href="download.htm#osx">OS X</a>, <a href="download.htm#android">Android</a> and <a href="download.htm#linux">Linux</a>.</p>
                <br>
            </center>

            <div class="row" id="tiles" style="overflow: hidden;">
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-01.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-02.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-03.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-04.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-05.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-06.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-07.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-08.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-09.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-10.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-01.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
                <div class="col-lg-3 col-md-4 col-sm-6" style="background: linear-gradient( rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3) ), url('splashimgs/dcss-splash-02.png'); background-position: center;">
                    <p class="lead text-center dcss-tile-heading"></p>
                    <p class="text-center dcss-tile-body"></p>
                    <a class="dcss-tile-link" href="#"><p class="text-center">Watch now</p></a>
                </div>
            </div>
            <a href="watch.htm"><p id="dcss-online-link">See all games...</p></a>

            <h2>Latest News</h2>
            <div class="container" id="newsContainer"></div>
            <p><a href="http://crawl.develz.org/wordpress/blog">All news...</a></p>

            <h2>Help & Community</h2>
            <ul>
                <li><a href="about.htm">About</a>: Learn more about DCSS.</li>
                <li><a href="http://crawl.chaosforge.org/">Wiki</a>: Up-to-date information on game items &amp; concepts.</li>
                <li><a href="https://crawl.develz.org/tavern/">Forum</a>: "Debate" strategy and changes on our forums.</a></li>
                <li><a href="http://webchat.freenode.net/?channels=%23%23crawl">IRC</a>: ##crawl on Freenode IRC is filled with helpful (and otherwise) souls who can offer real-time advice.</li>
                <li><a href="https://crawl.develz.org/mantis/">Bug Reports</a>: Found a problem? Let us know!</li>
            </ul>

            <hr>
            <p class="small text-right">You are too berserk!</p>

        </div>
    </body>
</html>
